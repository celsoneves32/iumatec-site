// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  PENDING
  PAID
  FULFILLED
  CANCELED
  REFUNDED
}

model Order {
  id             String      @id @default(cuid())
  userId         String      // Supabase auth user id (uuid como string)
  status         OrderStatus @default(PENDING)

  currency       String      @default("CHF")
  subtotal       Int         @default(0) // em centimos
  shipping       Int         @default(0)
  tax            Int         @default(0)
  total          Int         @default(0)

  // opcional: referÃªncia a checkout/order do Shopify
  shopifyCheckoutId String?
  shopifyOrderId    String?

  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  items          OrderItem[]
  @@index([userId, createdAt])
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  title     String
  quantity  Int
  unitPrice Int      // em centimos
  sku       String?
  imageUrl  String?

  createdAt DateTime @default(now())
}
